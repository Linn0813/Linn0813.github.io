<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>📋 日志轮转完全指南：从原理到实践，让你的日志管理更专业 | Linn's Blog</title><meta name="author" content="yuxiaoling"><meta name="copyright" content="yuxiaoling"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="系统讲解日志轮转的原理、工具和实践，从 logrotate 到 logback、log4j，帮你掌握专业的日志管理方法，避免日志文件无限增长导致的问题。">
<meta property="og:type" content="article">
<meta property="og:title" content="📋 日志轮转完全指南：从原理到实践，让你的日志管理更专业">
<meta property="og:url" content="https://linn0813.github.io/2025/12/31/2025-12-31-log-rotation-guide/index.html">
<meta property="og:site_name" content="Linn&#39;s Blog">
<meta property="og:description" content="系统讲解日志轮转的原理、工具和实践，从 logrotate 到 logback、log4j，帮你掌握专业的日志管理方法，避免日志文件无限增长导致的问题。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://linn0813.github.io/img/log-rotation-guide.png">
<meta property="article:published_time" content="2025-12-31T12:00:00.000Z">
<meta property="article:modified_time" content="2025-12-31T12:00:00.000Z">
<meta property="article:author" content="yuxiaoling">
<meta property="article:tag" content="日志管理">
<meta property="article:tag" content="日志轮转">
<meta property="article:tag" content="logrotate">
<meta property="article:tag" content="logback">
<meta property="article:tag" content="log4j">
<meta property="article:tag" content="运维">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://linn0813.github.io/img/log-rotation-guide.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "📋 日志轮转完全指南：从原理到实践，让你的日志管理更专业",
  "url": "https://linn0813.github.io/2025/12/31/2025-12-31-log-rotation-guide/",
  "image": "https://linn0813.github.io/img/log-rotation-guide.png",
  "datePublished": "2025-12-31T12:00:00.000Z",
  "dateModified": "2025-12-31T12:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "yuxiaoling",
      "url": "https://linn0813.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://linn0813.github.io/2025/12/31/2025-12-31-log-rotation-guide/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="Xj7zV_DKnHFmJ7sXNRvdl5-UTfG4NLy-s7hDk1DZt4A"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":3,"unescape":true,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '📋 日志轮转完全指南：从原理到实践，让你的日志管理更专业',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/blog-enhancements.css"><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/ loading='lazy'></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">94</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">363</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/series/"><i class="fa-fw fa fa-book"></i><span> 系列</span></a></div><div class="menus_item"><a class="site-page" href="/qa/"><i class="fa-fw fa fa-comments"></i><span> 知识库问答</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/log-rotation-guide.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/logo.jpg" alt="Logo" loading='lazy'><span class="site-name">Linn's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">📋 日志轮转完全指南：从原理到实践，让你的日志管理更专业</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/series/"><i class="fa-fw fa fa-book"></i><span> 系列</span></a></div><div class="menus_item"><a class="site-page" href="/qa/"><i class="fa-fw fa fa-comments"></i><span> 知识库问答</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">📋 日志轮转完全指南：从原理到实践，让你的日志管理更专业</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-12-31T12:00:00.000Z" title="发表于 2025-12-31 20:00:00">2025-12-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-12-31T12:00:00.000Z" title="更新于 2025-12-31 20:00:00">2025-12-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%A1%8C%E4%B8%9A%E8%B6%8B%E5%8A%BF/">技术学习与行业趋势</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E4%B8%8E%E8%A1%8C%E4%B8%9A%E8%B6%8B%E5%8A%BF/%E5%BC%80%E5%8F%91%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%A0%88/">开发与技术栈</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">7.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>29分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>你有没有遇到过这样的情况：</p>
<blockquote>
<p><strong>服务器磁盘空间告警，一查发现是日志文件占满了磁盘</strong><br><strong>应用运行几个月后，日志文件达到几十 GB，打开都困难</strong><br><strong>想删除旧日志，又担心误删正在使用的日志文件</strong></p>
</blockquote>
<p>这些问题，都可以通过 <strong>日志轮转（Log Rotation）</strong> 来解决。</p>
<p>这篇文章将从<strong>问题场景 → 核心原理 → 工具使用 → 最佳实践</strong>，带你系统掌握日志轮转的完整知识体系。</p>
<hr>
<h2 id="一、问题场景：为什么需要日志轮转？"><a href="#一、问题场景：为什么需要日志轮转？" class="headerlink" title="一、问题场景：为什么需要日志轮转？"></a>一、问题场景：为什么需要日志轮转？</h2><h3 id="1️⃣-典型问题"><a href="#1️⃣-典型问题" class="headerlink" title="1️⃣ 典型问题"></a><strong>1️⃣ 典型问题</strong></h3><h4 id="问题-1：磁盘空间被占满"><a href="#问题-1：磁盘空间被占满" class="headerlink" title="问题 1：磁盘空间被占满"></a><strong>问题 1：磁盘空间被占满</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看磁盘使用情况</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/sda1        50G   48G  500M  99% /</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找大文件</span></span><br><span class="line"><span class="built_in">du</span> -sh /var/log/* | <span class="built_in">sort</span> -rh | <span class="built_in">head</span> -5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line">45G    /var/log/app.log</span><br><span class="line">2G     /var/log/nginx/access.log</span><br><span class="line">500M   /var/log/syslog</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong> 应用日志文件 <code>app.log</code> 已经达到 45GB，占满了磁盘空间。</p>
<h4 id="问题-2：日志文件过大，难以处理"><a href="#问题-2：日志文件过大，难以处理" class="headerlink" title="问题 2：日志文件过大，难以处理"></a><strong>问题 2：日志文件过大，难以处理</strong></h4><ul>
<li>打开日志文件需要很长时间</li>
<li>搜索日志内容非常慢</li>
<li>传输日志文件困难</li>
<li>日志分析工具无法处理</li>
</ul>
<h4 id="问题-3：历史日志丢失"><a href="#问题-3：历史日志丢失" class="headerlink" title="问题 3：历史日志丢失"></a><strong>问题 3：历史日志丢失</strong></h4><ul>
<li>手动删除日志容易误删</li>
<li>没有归档机制，历史日志无法追溯</li>
<li>无法按时间、大小等规则管理日志</li>
</ul>
<h3 id="2️⃣-日志轮转的价值"><a href="#2️⃣-日志轮转的价值" class="headerlink" title="2️⃣ 日志轮转的价值"></a><strong>2️⃣ 日志轮转的价值</strong></h3><p><strong>日志轮转（Log Rotation）</strong> 是一种日志管理机制，通过以下方式解决上述问题：</p>
<ul>
<li>✅ <strong>自动切割</strong>：按时间或大小自动切割日志文件</li>
<li>✅ <strong>自动归档</strong>：将旧日志压缩、归档，节省空间</li>
<li>✅ <strong>自动清理</strong>：删除过期的历史日志</li>
<li>✅ <strong>无缝切换</strong>：应用无需重启，自动切换到新日志文件</li>
</ul>
<hr>
<h2 id="二、基础概念科普：理解日志和文件系统"><a href="#二、基础概念科普：理解日志和文件系统" class="headerlink" title="二、基础概念科普：理解日志和文件系统"></a>二、基础概念科普：理解日志和文件系统</h2><p>在深入日志轮转之前，我们需要先理解一些基础概念。</p>
<h3 id="1️⃣-什么是日志文件"><a href="#1️⃣-什么是日志文件" class="headerlink" title="1️⃣ 什么是日志文件"></a><strong>1️⃣ 什么是日志文件</strong></h3><p><strong>日志文件（Log File）</strong> 是应用程序记录运行状态、错误信息、操作记录等信息的文本文件。</p>
<p><strong>日志的作用：</strong></p>
<ul>
<li><strong>问题排查</strong>：当应用出错时，通过日志定位问题</li>
<li><strong>行为追踪</strong>：记录用户操作、系统事件</li>
<li><strong>性能分析</strong>：记录响应时间、资源使用情况</li>
<li><strong>审计合规</strong>：满足合规要求，保留操作记录</li>
</ul>
<p><strong>日志的特点：</strong></p>
<ul>
<li><strong>只追加（Append Only）</strong>：日志通常只往文件末尾追加内容，不修改已有内容</li>
<li><strong>持续增长</strong>：只要应用在运行，日志就会不断增长</li>
<li><strong>文本格式</strong>：通常是可读的文本格式，便于人工查看</li>
</ul>
<h3 id="2️⃣-为什么日志文件会不断增长"><a href="#2️⃣-为什么日志文件会不断增长" class="headerlink" title="2️⃣ 为什么日志文件会不断增长"></a><strong>2️⃣ 为什么日志文件会不断增长</strong></h3><p><strong>日志文件增长的原因：</strong></p>
<ol>
<li><strong>应用持续运行</strong>：只要应用在运行，就会不断产生日志</li>
<li><strong>高频操作</strong>：用户请求、数据库操作、API 调用都会产生日志</li>
<li><strong>详细记录</strong>：为了排查问题，日志通常记录得很详细</li>
<li><strong>没有清理机制</strong>：如果不主动清理，日志会一直累积</li>
</ol>
<p><strong>举个例子：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">一个 Web 应用，每秒处理 100 个请求</span><br><span class="line">每个请求产生 1KB 日志</span><br><span class="line">一天产生的日志 = 100 请求/秒 × 1KB × 86400 秒 = 8.64GB</span><br><span class="line">一个月 = 8.64GB × 30 = 259GB</span><br></pre></td></tr></table></figure>

<h3 id="3️⃣-文件描述符（File-Descriptor）的概念"><a href="#3️⃣-文件描述符（File-Descriptor）的概念" class="headerlink" title="3️⃣ 文件描述符（File Descriptor）的概念"></a><strong>3️⃣ 文件描述符（File Descriptor）的概念</strong></h3><p><strong>文件描述符</strong>是操作系统用来标识打开文件的数字。理解这个概念对理解日志轮转很重要。</p>
<p><strong>工作原理：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">应用启动时：</span><br><span class="line">1. 打开日志文件 app.log</span><br><span class="line">2. 操作系统分配文件描述符（比如 fd=3）</span><br><span class="line">3. 应用通过 fd=3 写入日志</span><br><span class="line"></span><br><span class="line">应用写入日志时：</span><br><span class="line">write(fd=3, &quot;log message&quot;)  →  写入到 app.log</span><br><span class="line"></span><br><span class="line">如果直接删除或重命名 app.log：</span><br><span class="line">- 文件描述符 fd=3 仍然指向原来的文件</span><br><span class="line">- 应用继续通过 fd=3 写入</span><br><span class="line">- 但文件已经不在文件系统中了（成为&quot;孤儿文件&quot;）</span><br><span class="line">- 只有应用关闭文件或重启，文件才会真正删除</span><br></pre></td></tr></table></figure>

<p><strong>为什么这很重要？</strong></p>
<ul>
<li>日志轮转时，不能直接删除或重命名正在写入的文件</li>
<li>需要让应用重新打开文件，获取新的文件描述符</li>
<li>这就是为什么需要 <code>postrotate</code> 脚本发送信号让应用重新打开文件</li>
</ul>
<h3 id="4️⃣-日志写入的机制"><a href="#4️⃣-日志写入的机制" class="headerlink" title="4️⃣ 日志写入的机制"></a><strong>4️⃣ 日志写入的机制</strong></h3><p><strong>应用如何写入日志：</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Python 示例</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开日志文件（获取文件描述符）</span></span><br><span class="line">logging.basicConfig(filename=<span class="string">&#x27;app.log&#x27;</span>, level=logging.INFO)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入日志（通过文件描述符）</span></span><br><span class="line">logging.info(<span class="string">&#x27;This is a log message&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>底层过程：</strong></p>
<ol>
<li>应用打开文件，获取文件描述符</li>
<li>写入日志时，操作系统将数据写入文件</li>
<li>数据可能先写入缓冲区，然后刷新到磁盘</li>
<li>文件指针（文件末尾）不断后移</li>
</ol>
<h3 id="5️⃣-文件重命名的原理"><a href="#5️⃣-文件重命名的原理" class="headerlink" title="5️⃣ 文件重命名的原理"></a><strong>5️⃣ 文件重命名的原理</strong></h3><p><strong>文件重命名（Rename）</strong> 是日志轮转的核心操作。</p>
<p><strong>重命名的特点：</strong></p>
<ul>
<li><strong>原子操作</strong>：重命名是原子性的，要么成功要么失败</li>
<li><strong>不改变文件内容</strong>：只改变文件名，文件内容不变</li>
<li><strong>不改变文件描述符</strong>：已打开的文件描述符仍然有效</li>
</ul>
<p><strong>示例：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 初始状态</span></span><br><span class="line">app.log (文件描述符 fd=3 指向它)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重命名操作</span></span><br><span class="line"><span class="built_in">mv</span> app.log app.log.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果</span></span><br><span class="line">app.log.1 (文件描述符 fd=3 仍然指向它)</span><br><span class="line">app.log (不存在)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用继续通过 fd=3 写入，数据写入到 app.log.1</span></span><br><span class="line"><span class="comment"># 这就是为什么需要让应用重新打开文件</span></span><br></pre></td></tr></table></figure>

<h3 id="6️⃣-什么是日志轮转"><a href="#6️⃣-什么是日志轮转" class="headerlink" title="6️⃣ 什么是日志轮转"></a><strong>6️⃣ 什么是日志轮转</strong></h3><p><strong>日志轮转（Log Rotation）</strong> 是指<strong>定期或按条件将当前日志文件重命名、归档，并创建新的日志文件继续写入</strong>的过程。</p>
<p><strong>核心思想：</strong></p>
<ul>
<li>不删除正在使用的日志文件</li>
<li>通过重命名”冻结”旧日志</li>
<li>创建新文件继续写入</li>
<li>对旧日志进行压缩、归档、清理</li>
</ul>
<h3 id="7️⃣-轮转过程详细示意"><a href="#7️⃣-轮转过程详细示意" class="headerlink" title="7️⃣ 轮转过程详细示意"></a><strong>7️⃣ 轮转过程详细示意</strong></h3><p>让我们详细看看轮转的每一步：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">【初始状态】</span><br><span class="line">app.log (100MB，正在写入，文件描述符 fd=3)</span><br><span class="line"></span><br><span class="line">【触发轮转：文件达到 100MB】</span><br><span class="line"></span><br><span class="line">步骤 1：重命名当前文件</span><br><span class="line">app.log → app.log.1 (重命名，fd=3 仍然指向 app.log.1)</span><br><span class="line"></span><br><span class="line">步骤 2：创建新文件</span><br><span class="line">创建新的 app.log (空文件)</span><br><span class="line"></span><br><span class="line">步骤 3：通知应用重新打开文件</span><br><span class="line">发送信号（如 SIGHUP）给应用</span><br><span class="line">应用关闭 fd=3，重新打开 app.log，获得新的 fd=4</span><br><span class="line"></span><br><span class="line">步骤 4：压缩旧文件（可选）</span><br><span class="line">app.log.1 → app.log.1.gz (压缩，节省空间)</span><br><span class="line"></span><br><span class="line">【结果】</span><br><span class="line">app.log (新文件，0MB，正在写入，fd=4)</span><br><span class="line">app.log.1.gz (旧文件，压缩后 20MB，已归档)</span><br></pre></td></tr></table></figure>

<h3 id="8️⃣-为什么需要重新打开文件"><a href="#8️⃣-为什么需要重新打开文件" class="headerlink" title="8️⃣ 为什么需要重新打开文件"></a><strong>8️⃣ 为什么需要重新打开文件</strong></h3><p><strong>如果不重新打开文件会怎样？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">场景：轮转后不通知应用</span><br><span class="line"></span><br><span class="line">1. app.log → app.log.1 (重命名)</span><br><span class="line">2. 创建新的 app.log</span><br><span class="line">3. 应用仍然通过 fd=3 写入</span><br><span class="line"></span><br><span class="line">结果：</span><br><span class="line">- 应用写入的数据进入 app.log.1（旧文件）</span><br><span class="line">- 新的 app.log 是空的</span><br><span class="line">- 日志写入到了错误的地方</span><br></pre></td></tr></table></figure>

<p><strong>重新打开文件后：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. app.log → app.log.1 (重命名)</span><br><span class="line">2. 创建新的 app.log</span><br><span class="line">3. 发送信号给应用</span><br><span class="line">4. 应用关闭旧文件，打开新文件</span><br><span class="line">5. 应用通过新的文件描述符写入 app.log（正确）</span><br></pre></td></tr></table></figure>

<h3 id="9️⃣-轮转触发条件详解"><a href="#9️⃣-轮转触发条件详解" class="headerlink" title="9️⃣ 轮转触发条件详解"></a><strong>9️⃣ 轮转触发条件详解</strong></h3><p>日志轮转可以在以下条件下触发：</p>
<h4 id="按时间轮转"><a href="#按时间轮转" class="headerlink" title="按时间轮转"></a><strong>按时间轮转</strong></h4><ul>
<li><strong>daily（每天）</strong>：每天午夜轮转</li>
<li><strong>weekly（每周）</strong>：每周轮转（通常是周日）</li>
<li><strong>monthly（每月）</strong>：每月第一天轮转</li>
<li><strong>适合场景</strong>：日志量相对稳定，需要按时间查找日志</li>
</ul>
<h4 id="按大小轮转"><a href="#按大小轮转" class="headerlink" title="按大小轮转"></a><strong>按大小轮转</strong></h4><ul>
<li><strong>size 100M</strong>：文件达到 100MB 时轮转</li>
<li><strong>size 1G</strong>：文件达到 1GB 时轮转</li>
<li><strong>适合场景</strong>：日志量不固定，可能突然增长</li>
</ul>
<h4 id="按大小-时间轮转"><a href="#按大小-时间轮转" class="headerlink" title="按大小+时间轮转"></a><strong>按大小+时间轮转</strong></h4><ul>
<li><strong>size 500M 或 daily</strong>：满足任一条件就轮转</li>
<li><strong>适合场景</strong>：生产环境推荐，兼顾大小和时间</li>
</ul>
<h4 id="手动触发"><a href="#手动触发" class="headerlink" title="手动触发"></a><strong>手动触发</strong></h4><ul>
<li>通过命令手动触发轮转</li>
<li>用于测试或特殊情况</li>
</ul>
<h3 id="🔟-轮转后的处理操作"><a href="#🔟-轮转后的处理操作" class="headerlink" title="🔟 轮转后的处理操作"></a><strong>🔟 轮转后的处理操作</strong></h3><h4 id="压缩（Compress）"><a href="#压缩（Compress）" class="headerlink" title="压缩（Compress）"></a><strong>压缩（Compress）</strong></h4><ul>
<li><strong>目的</strong>：节省磁盘空间（通常可节省 70-90%）</li>
<li><strong>工具</strong>：gzip、bzip2、xz</li>
<li><strong>时机</strong>：立即压缩或延迟压缩（delaycompress）</li>
</ul>
<p><strong>压缩效果示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">原始日志：100MB</span><br><span class="line">压缩后：10-30MB（取决于日志内容）</span><br><span class="line">节省空间：70-90%</span><br></pre></td></tr></table></figure>

<h4 id="归档（Archive）"><a href="#归档（Archive）" class="headerlink" title="归档（Archive）"></a><strong>归档（Archive）</strong></h4><ul>
<li><strong>目的</strong>：将旧日志移动到指定目录保存</li>
<li><strong>方式</strong>：移动到 archive 目录，按日期组织</li>
<li><strong>用途</strong>：长期保存，便于查找</li>
</ul>
<h4 id="删除（Delete）"><a href="#删除（Delete）" class="headerlink" title="删除（Delete）"></a><strong>删除（Delete）</strong></h4><ul>
<li><strong>目的</strong>：删除超过保留期的旧日志</li>
<li><strong>策略</strong>：按天数（maxHistory）或总大小（totalSizeCap）</li>
<li><strong>注意</strong>：确保重要日志已备份</li>
</ul>
<h4 id="通知（Notification）"><a href="#通知（Notification）" class="headerlink" title="通知（Notification）"></a><strong>通知（Notification）</strong></h4><ul>
<li><strong>目的</strong>：轮转完成后通知管理员</li>
<li><strong>方式</strong>：邮件、告警、日志记录</li>
</ul>
<hr>
<h2 id="三、核心概念：日志轮转的原理"><a href="#三、核心概念：日志轮转的原理" class="headerlink" title="三、核心概念：日志轮转的原理"></a>三、核心概念：日志轮转的原理</h2><h3 id="1️⃣-日志轮转的完整流程"><a href="#1️⃣-日志轮转的完整流程" class="headerlink" title="1️⃣ 日志轮转的完整流程"></a><strong>1️⃣ 日志轮转的完整流程</strong></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">【监控阶段】</span><br><span class="line">持续监控日志文件（大小、时间）</span><br><span class="line"></span><br><span class="line">【触发阶段】</span><br><span class="line">满足轮转条件（大小/时间）</span><br><span class="line"></span><br><span class="line">【执行阶段】</span><br><span class="line">1. 重命名当前日志文件</span><br><span class="line">2. 创建新的日志文件</span><br><span class="line">3. 通知应用重新打开文件</span><br><span class="line">4. 压缩旧日志文件</span><br><span class="line">5. 清理过期日志文件</span><br><span class="line"></span><br><span class="line">【完成阶段】</span><br><span class="line">记录轮转日志，发送通知</span><br></pre></td></tr></table></figure>

<h3 id="2️⃣-轮转策略对比"><a href="#2️⃣-轮转策略对比" class="headerlink" title="2️⃣ 轮转策略对比"></a><strong>2️⃣ 轮转策略对比</strong></h3><table>
<thead>
<tr>
<th>策略</th>
<th>优点</th>
<th>缺点</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td><strong>按时间</strong></td>
<td>便于按时间查找、日志量可控</td>
<td>可能单个文件过大</td>
<td>日志量稳定</td>
</tr>
<tr>
<td><strong>按大小</strong></td>
<td>防止文件过大、灵活</td>
<td>文件数量不可控</td>
<td>日志量波动大</td>
</tr>
<tr>
<td><strong>按大小+时间</strong></td>
<td>兼顾两者优点</td>
<td>配置复杂</td>
<td>生产环境推荐</td>
</tr>
</tbody></table>
<h3 id="3️⃣-保留策略"><a href="#3️⃣-保留策略" class="headerlink" title="3️⃣ 保留策略"></a><strong>3️⃣ 保留策略</strong></h3><p><strong>保留策略决定保留多少历史日志：</strong></p>
<ul>
<li><strong>按数量（rotate）</strong>：保留 N 个文件<ul>
<li>例如：<code>rotate 10</code> 保留 10 个文件</li>
</ul>
</li>
<li><strong>按天数（maxHistory）</strong>：保留 N 天的日志<ul>
<li>例如：<code>maxHistory 30</code> 保留 30 天</li>
</ul>
</li>
<li><strong>按总大小（totalSizeCap）</strong>：总大小不超过 N<ul>
<li>例如：<code>totalSizeCap 10GB</code> 总大小不超过 10GB</li>
</ul>
</li>
</ul>
<p><strong>推荐配置：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">保留天数：30 天（业务日志）</span><br><span class="line">保留大小：10GB（总大小限制）</span><br><span class="line">保留数量：10-30 个文件</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四、Linux-系统工具：logrotate"><a href="#四、Linux-系统工具：logrotate" class="headerlink" title="四、Linux 系统工具：logrotate"></a>四、Linux 系统工具：logrotate</h2><h3 id="1️⃣-logrotate-简介"><a href="#1️⃣-logrotate-简介" class="headerlink" title="1️⃣ logrotate 简介"></a><strong>1️⃣ logrotate 简介</strong></h3><p><strong>logrotate</strong> 是 Linux 系统自带的日志轮转工具，通过配置文件定义轮转规则。</p>
<p><strong>logrotate 的特点：</strong></p>
<ul>
<li><strong>系统自带</strong>：大多数 Linux 发行版都预装了 logrotate</li>
<li><strong>配置文件驱动</strong>：通过配置文件定义轮转规则，无需编程</li>
<li><strong>定时执行</strong>：通过 cron 定时任务自动执行</li>
<li><strong>灵活强大</strong>：支持多种轮转策略和自定义脚本</li>
</ul>
<h3 id="2️⃣-配置文件位置和结构"><a href="#2️⃣-配置文件位置和结构" class="headerlink" title="2️⃣ 配置文件位置和结构"></a><strong>2️⃣ 配置文件位置和结构</strong></h3><h4 id="配置文件位置"><a href="#配置文件位置" class="headerlink" title="配置文件位置"></a><strong>配置文件位置</strong></h4><ul>
<li><p><strong>主配置文件</strong>：<code>/etc/logrotate.conf</code></p>
<ul>
<li>定义全局默认设置</li>
<li>包含其他配置文件的引用</li>
</ul>
</li>
<li><p><strong>应用配置文件</strong>：<code>/etc/logrotate.d/*</code></p>
<ul>
<li>每个应用一个配置文件</li>
<li>文件名通常与应用名相同</li>
</ul>
</li>
</ul>
<h4 id="配置文件结构"><a href="#配置文件结构" class="headerlink" title="配置文件结构"></a><strong>配置文件结构</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /etc/logrotate.conf（主配置）</span></span><br><span class="line"><span class="comment"># 全局默认设置</span></span><br><span class="line">weekly          <span class="comment"># 默认每周轮转</span></span><br><span class="line">rotate 4        <span class="comment"># 默认保留 4 个文件</span></span><br><span class="line">create          <span class="comment"># 默认创建新文件</span></span><br><span class="line">compress        <span class="comment"># 默认压缩</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 包含应用配置</span></span><br><span class="line">include /etc/logrotate.d</span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/logrotate.d/myapp（应用配置）</span></span><br><span class="line">/var/log/myapp/*.<span class="built_in">log</span> &#123;</span><br><span class="line">    <span class="comment"># 应用特定的配置</span></span><br><span class="line">    <span class="comment"># 会覆盖全局默认设置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置文件的优先级"><a href="#配置文件的优先级" class="headerlink" title="配置文件的优先级"></a><strong>配置文件的优先级</strong></h4><ol>
<li><strong>应用配置</strong> 覆盖 <strong>全局配置</strong></li>
<li><strong>后面的配置</strong> 覆盖 <strong>前面的配置</strong></li>
<li><strong>具体配置</strong> 覆盖 <strong>通用配置</strong></li>
</ol>
<h3 id="3️⃣-基本配置示例"><a href="#3️⃣-基本配置示例" class="headerlink" title="3️⃣ 基本配置示例"></a><strong>3️⃣ 基本配置示例</strong></h3><h4 id="示例-1：按大小轮转"><a href="#示例-1：按大小轮转" class="headerlink" title="示例 1：按大小轮转"></a><strong>示例 1：按大小轮转</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /etc/logrotate.d/myapp</span></span><br><span class="line">/var/log/myapp/*.<span class="built_in">log</span> &#123;</span><br><span class="line">    size 100M          <span class="comment"># 文件达到 100MB 时轮转</span></span><br><span class="line">    rotate 10         <span class="comment"># 保留 10 个历史文件</span></span><br><span class="line">    compress          <span class="comment"># 压缩旧日志</span></span><br><span class="line">    delaycompress     <span class="comment"># 延迟压缩（压缩前一个文件）</span></span><br><span class="line">    missingok         <span class="comment"># 文件不存在时不报错</span></span><br><span class="line">    notifempty        <span class="comment"># 空文件不轮转</span></span><br><span class="line">    create 0644 app app  <span class="comment"># 创建新文件的权限和所有者</span></span><br><span class="line">    postrotate        <span class="comment"># 轮转后执行的命令</span></span><br><span class="line">        /bin/kill -HUP `<span class="built_in">cat</span> /var/run/myapp.pid 2&gt; /dev/null` 2&gt; /dev/null || <span class="literal">true</span></span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="示例-2：按时间轮转"><a href="#示例-2：按时间轮转" class="headerlink" title="示例 2：按时间轮转"></a><strong>示例 2：按时间轮转</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /etc/logrotate.d/myapp</span></span><br><span class="line">/var/log/myapp/*.<span class="built_in">log</span> &#123;</span><br><span class="line">    daily             <span class="comment"># 每天轮转</span></span><br><span class="line">    rotate 30         <span class="comment"># 保留 30 天的日志</span></span><br><span class="line">    compress          <span class="comment"># 压缩</span></span><br><span class="line">    dateext           <span class="comment"># 使用日期作为后缀</span></span><br><span class="line">    dateformat -%Y%m%d  <span class="comment"># 日期格式</span></span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    sharedscripts     <span class="comment"># 所有文件轮转完再执行脚本</span></span><br><span class="line">    postrotate</span><br><span class="line">        systemctl reload myapp || <span class="literal">true</span></span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="示例-3：按大小和时间轮转"><a href="#示例-3：按大小和时间轮转" class="headerlink" title="示例 3：按大小和时间轮转"></a><strong>示例 3：按大小和时间轮转</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /etc/logrotate.d/myapp</span></span><br><span class="line">/var/log/myapp/*.<span class="built_in">log</span> &#123;</span><br><span class="line">    size 500M         <span class="comment"># 达到 500MB 或</span></span><br><span class="line">    daily             <span class="comment"># 每天轮转（满足任一条件）</span></span><br><span class="line">    rotate 7          <span class="comment"># 保留 7 个文件</span></span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    create 0644 app app</span><br><span class="line">    sharedscripts</span><br><span class="line">    postrotate</span><br><span class="line">        /usr/bin/pkill -HUP -f myapp</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4️⃣-常用配置参数详解"><a href="#4️⃣-常用配置参数详解" class="headerlink" title="4️⃣ 常用配置参数详解"></a><strong>4️⃣ 常用配置参数详解</strong></h3><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
<th>详细解释</th>
</tr>
</thead>
<tbody><tr>
<td><code>daily</code></td>
<td>每天轮转</td>
<td><code>daily</code></td>
<td>每天午夜（00:00）轮转一次</td>
</tr>
<tr>
<td><code>weekly</code></td>
<td>每周轮转</td>
<td><code>weekly</code></td>
<td>每周轮转一次（通常是周日）</td>
</tr>
<tr>
<td><code>monthly</code></td>
<td>每月轮转</td>
<td><code>monthly</code></td>
<td>每月第一天轮转</td>
</tr>
<tr>
<td><code>size</code></td>
<td>按大小轮转</td>
<td><code>size 100M</code></td>
<td>文件达到指定大小时轮转，支持 K&#x2F;M&#x2F;G 单位</td>
</tr>
<tr>
<td><code>rotate</code></td>
<td>保留文件数</td>
<td><code>rotate 10</code></td>
<td>保留 N 个历史文件，超过的会被删除</td>
</tr>
<tr>
<td><code>compress</code></td>
<td>压缩旧日志</td>
<td><code>compress</code></td>
<td>使用 gzip 压缩旧日志文件</td>
</tr>
<tr>
<td><code>delaycompress</code></td>
<td>延迟压缩</td>
<td><code>delaycompress</code></td>
<td>延迟压缩，只压缩前一个文件（不压缩最新的旧文件）</td>
</tr>
<tr>
<td><code>dateext</code></td>
<td>使用日期后缀</td>
<td><code>dateext</code></td>
<td>使用日期作为文件后缀，而不是数字</td>
</tr>
<tr>
<td><code>dateformat</code></td>
<td>日期格式</td>
<td><code>dateformat -%Y%m%d</code></td>
<td>日期格式，如 <code>-20251230</code></td>
</tr>
<tr>
<td><code>missingok</code></td>
<td>文件不存在不报错</td>
<td><code>missingok</code></td>
<td>如果日志文件不存在，不报错继续执行</td>
</tr>
<tr>
<td><code>notifempty</code></td>
<td>空文件不轮转</td>
<td><code>notifempty</code></td>
<td>如果日志文件为空，不进行轮转</td>
</tr>
<tr>
<td><code>create</code></td>
<td>创建新文件</td>
<td><code>create 0644 user group</code></td>
<td>创建新文件的权限、所有者、组</td>
</tr>
<tr>
<td><code>postrotate</code></td>
<td>轮转后执行脚本</td>
<td><code>postrotate ... endscript</code></td>
<td>轮转完成后执行的命令（通常用于通知应用）</td>
</tr>
<tr>
<td><code>prerotate</code></td>
<td>轮转前执行脚本</td>
<td><code>prerotate ... endscript</code></td>
<td>轮转前执行的命令</td>
</tr>
<tr>
<td><code>sharedscripts</code></td>
<td>共享脚本</td>
<td><code>sharedscripts</code></td>
<td>所有文件轮转完再执行脚本（而不是每个文件都执行）</td>
</tr>
</tbody></table>
<h3 id="5️⃣-重要参数详解"><a href="#5️⃣-重要参数详解" class="headerlink" title="5️⃣ 重要参数详解"></a><strong>5️⃣ 重要参数详解</strong></h3><h4 id="compress-vs-delaycompress"><a href="#compress-vs-delaycompress" class="headerlink" title="compress vs delaycompress"></a><strong>compress vs delaycompress</strong></h4><p><strong>compress（立即压缩）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">轮转后：</span><br><span class="line">app.log.1 → app.log.1.gz (立即压缩)</span><br><span class="line">app.log.2 → app.log.2.gz (立即压缩)</span><br></pre></td></tr></table></figure>

<p><strong>delaycompress（延迟压缩）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">轮转后：</span><br><span class="line">app.log.1 (不压缩，方便查看最新旧日志)</span><br><span class="line">app.log.2 → app.log.2.gz (压缩)</span><br><span class="line">app.log.3 → app.log.3.gz (压缩)</span><br></pre></td></tr></table></figure>

<p><strong>为什么需要 delaycompress？</strong></p>
<ul>
<li>最新的旧日志可能还需要查看</li>
<li>压缩后的文件需要解压才能查看</li>
<li>延迟压缩让最新旧日志保持可读</li>
</ul>
<h4 id="create-参数详解"><a href="#create-参数详解" class="headerlink" title="create 参数详解"></a><strong>create 参数详解</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create 0644 app app</span><br></pre></td></tr></table></figure>

<p><strong>格式：</strong> <code>create [权限] [所有者] [组]</code></p>
<ul>
<li><strong>权限</strong>：<code>0644</code> 表示 <code>rw-r--r--</code>（所有者可读写，其他人只读）</li>
<li><strong>所有者</strong>：新文件的所有者</li>
<li><strong>组</strong>：新文件的组</li>
</ul>
<p><strong>为什么需要 create？</strong></p>
<ul>
<li>轮转后创建的新文件需要正确的权限</li>
<li>确保应用可以写入新文件</li>
<li>避免权限问题导致日志写入失败</li>
</ul>
<h4 id="postrotate-脚本的作用"><a href="#postrotate-脚本的作用" class="headerlink" title="postrotate 脚本的作用"></a><strong>postrotate 脚本的作用</strong></h4><p><strong>为什么需要 postrotate？</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">问题：轮转后应用还在写旧文件</span><br><span class="line"></span><br><span class="line">原因：</span><br><span class="line">1. 应用打开文件时获得文件描述符（fd=3）</span><br><span class="line">2. 文件重命名后，fd=3 仍然指向旧文件</span><br><span class="line">3. 应用继续通过 fd=3 写入旧文件</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">postrotate</span><br><span class="line">    /bin/kill -HUP `cat /var/run/myapp.pid`</span><br><span class="line">endscript</span><br><span class="line"></span><br><span class="line">作用：</span><br><span class="line">- 发送 SIGHUP 信号给应用</span><br><span class="line">- 应用收到信号后重新打开日志文件</span><br><span class="line">- 获得新的文件描述符，指向新文件</span><br></pre></td></tr></table></figure>

<p><strong>常见的 postrotate 命令：</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 方式 1：通过 PID 文件发送信号</span></span><br><span class="line">/bin/kill -HUP `<span class="built_in">cat</span> /var/run/myapp.pid`</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式 2：使用 systemd 重载</span></span><br><span class="line">systemctl reload myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式 3：使用 pkill</span></span><br><span class="line">/usr/bin/pkill -HUP -f myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式 4：重启服务（不推荐，会中断服务）</span></span><br><span class="line">systemctl restart myapp</span><br></pre></td></tr></table></figure>

<h3 id="5️⃣-测试和调试"><a href="#5️⃣-测试和调试" class="headerlink" title="5️⃣ 测试和调试"></a><strong>5️⃣ 测试和调试</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 测试配置文件语法</span></span><br><span class="line"><span class="built_in">sudo</span> logrotate -d /etc/logrotate.d/myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制执行轮转（测试）</span></span><br><span class="line"><span class="built_in">sudo</span> logrotate -f /etc/logrotate.d/myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看执行日志</span></span><br><span class="line"><span class="built_in">cat</span> /var/lib/logrotate/status</span><br></pre></td></tr></table></figure>

<h3 id="6️⃣-logrotate-的工作原理"><a href="#6️⃣-logrotate-的工作原理" class="headerlink" title="6️⃣ logrotate 的工作原理"></a><strong>6️⃣ logrotate 的工作原理</strong></h3><h4 id="执行机制"><a href="#执行机制" class="headerlink" title="执行机制"></a><strong>执行机制</strong></h4><p>logrotate 通过 <strong>cron</strong> 定时任务执行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看 cron 任务</span></span><br><span class="line"><span class="built_in">cat</span> /etc/cron.daily/logrotate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内容</span></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line">/usr/sbin/logrotate /etc/logrotate.conf</span><br><span class="line">EXITVALUE=$?</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$EXITVALUE</span> != 0 ]; <span class="keyword">then</span></span><br><span class="line">    /usr/bin/logger -t logrotate <span class="string">&quot;ALERT exited abnormally with [<span class="variable">$EXITVALUE</span>]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<p><strong>执行流程：</strong></p>
<ol>
<li><strong>cron 定时触发</strong>：每天执行一次（默认）</li>
<li><strong>读取配置</strong>：读取 <code>/etc/logrotate.conf</code> 和 <code>/etc/logrotate.d/*</code></li>
<li><strong>检查条件</strong>：检查每个日志文件是否满足轮转条件</li>
<li><strong>执行轮转</strong>：满足条件的文件执行轮转</li>
<li><strong>记录状态</strong>：将执行结果记录到 <code>/var/lib/logrotate/status</code></li>
</ol>
<h4 id="执行时机"><a href="#执行时机" class="headerlink" title="执行时机"></a><strong>执行时机</strong></h4><ul>
<li><strong>默认</strong>：每天执行一次（通过 <code>/etc/cron.daily/logrotate</code>）</li>
<li><strong>可调整</strong>：可以修改 cron 任务调整执行频率</li>
<li><strong>手动执行</strong>：可以通过命令手动触发</li>
</ul>
<h4 id="状态文件"><a href="#状态文件" class="headerlink" title="状态文件"></a><strong>状态文件</strong></h4><p>logrotate 会记录每个文件的最后轮转时间：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看状态文件</span></span><br><span class="line"><span class="built_in">cat</span> /var/lib/logrotate/status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内容示例</span></span><br><span class="line">logrotate state -- version 2</span><br><span class="line"><span class="string">&quot;/var/log/myapp/app.log&quot;</span> 2025-12-29-12:0:0</span><br><span class="line"><span class="string">&quot;/var/log/nginx/access.log&quot;</span> 2025-12-30-0:0:0</span><br></pre></td></tr></table></figure>

<p><strong>作用：</strong></p>
<ul>
<li>记录每个文件的最后轮转时间</li>
<li>判断是否满足时间轮转条件（如 daily）</li>
<li>避免重复轮转</li>
</ul>
<h4 id="执行日志"><a href="#执行日志" class="headerlink" title="执行日志"></a><strong>执行日志</strong></h4><p>logrotate 的执行结果会记录到系统日志：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看执行日志</span></span><br><span class="line">grep logrotate /var/log/syslog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">journalctl -u logrotate</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五、Java-应用：Logback-日志轮转"><a href="#五、Java-应用：Logback-日志轮转" class="headerlink" title="五、Java 应用：Logback 日志轮转"></a>五、Java 应用：Logback 日志轮转</h2><h3 id="1️⃣-Logback-简介"><a href="#1️⃣-Logback-简介" class="headerlink" title="1️⃣ Logback 简介"></a><strong>1️⃣ Logback 简介</strong></h3><p><strong>Logback</strong> 是 Java 应用常用的日志框架，是 Log4j 的继任者，内置了强大的日志轮转功能。</p>
<p><strong>Logback 的特点：</strong></p>
<ul>
<li><strong>内置轮转</strong>：不需要外部工具，框架自身支持轮转</li>
<li><strong>配置灵活</strong>：支持 XML 和 Groovy 配置</li>
<li><strong>性能优秀</strong>：异步写入、缓冲等优化</li>
<li><strong>自动重载</strong>：支持配置文件自动重载</li>
</ul>
<p><strong>为什么 Java 应用需要框架级轮转？</strong></p>
<ul>
<li><strong>文件描述符管理</strong>：框架自动处理文件重新打开</li>
<li><strong>无缝切换</strong>：轮转时应用无需重启</li>
<li><strong>配置集中</strong>：日志配置和应用配置在一起</li>
<li><strong>跨平台</strong>：不依赖操作系统工具</li>
</ul>
<h3 id="2️⃣-配置文件示例"><a href="#2️⃣-配置文件示例" class="headerlink" title="2️⃣ 配置文件示例"></a><strong>2️⃣ 配置文件示例</strong></h3><h4 id="示例-1：按大小和时间轮转"><a href="#示例-1：按大小和时间轮转" class="headerlink" title="示例 1：按大小和时间轮转"></a><strong>示例 1：按大小和时间轮转</strong></h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- logback.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 当前日志文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>logs/app.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 轮转策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 历史日志文件命名模式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>logs/app.%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 单个文件最大大小 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 保留天数 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 总大小限制 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">totalSizeCap</span>&gt;</span>10GB<span class="tag">&lt;/<span class="name">totalSizeCap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 日志格式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="示例-2：按大小轮转"><a href="#示例-2：按大小轮转" class="headerlink" title="示例 2：按大小轮转"></a><strong>示例 2：按大小轮转</strong></h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>logs/app.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.FixedWindowRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>logs/app.%i.log.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">minIndex</span>&gt;</span>1<span class="tag">&lt;/<span class="name">minIndex</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxIndex</span>&gt;</span>10<span class="tag">&lt;/<span class="name">maxIndex</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">triggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">triggeringPolicy</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="示例-3：按时间轮转"><a href="#示例-3：按时间轮转" class="headerlink" title="示例 3：按时间轮转"></a><strong>示例 3：按时间轮转</strong></h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>logs/app.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>logs/app.%d&#123;yyyy-MM-dd&#125;.log.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">totalSizeCap</span>&gt;</span>10GB<span class="tag">&lt;/<span class="name">totalSizeCap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3️⃣-常用配置参数详解"><a href="#3️⃣-常用配置参数详解" class="headerlink" title="3️⃣ 常用配置参数详解"></a><strong>3️⃣ 常用配置参数详解</strong></h3><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
<th>详细解释</th>
</tr>
</thead>
<tbody><tr>
<td><code>fileNamePattern</code></td>
<td>历史文件命名模式</td>
<td><code>logs/app.%d&#123;yyyy-MM-dd&#125;.%i.log.gz</code></td>
<td>定义历史日志文件的命名规则，支持日期和索引</td>
</tr>
<tr>
<td><code>maxFileSize</code></td>
<td>单个文件最大大小</td>
<td><code>100MB</code></td>
<td>单个日志文件的最大大小，超过后轮转</td>
</tr>
<tr>
<td><code>maxHistory</code></td>
<td>保留天数</td>
<td><code>30</code></td>
<td>保留多少天的历史日志，超过的会被删除</td>
</tr>
<tr>
<td><code>totalSizeCap</code></td>
<td>总大小限制</td>
<td><code>10GB</code></td>
<td>所有日志文件的总大小限制，超过后删除最旧的</td>
</tr>
<tr>
<td><code>minIndex</code></td>
<td>最小索引</td>
<td><code>1</code></td>
<td>索引号的最小值（FixedWindowRollingPolicy）</td>
</tr>
<tr>
<td><code>maxIndex</code></td>
<td>最大索引</td>
<td><code>10</code></td>
<td>索引号的最大值，超过后删除最旧的</td>
</tr>
</tbody></table>
<h3 id="4️⃣-日期格式说明"><a href="#4️⃣-日期格式说明" class="headerlink" title="4️⃣ 日期格式说明"></a><strong>4️⃣ 日期格式说明</strong></h3><p><strong>fileNamePattern 中的格式符：</strong></p>
<table>
<thead>
<tr>
<th>格式</th>
<th>说明</th>
<th>示例</th>
<th>生成的文件名</th>
</tr>
</thead>
<tbody><tr>
<td><code>%d&#123;yyyy-MM-dd&#125;</code></td>
<td>日期</td>
<td><code>%d&#123;yyyy-MM-dd&#125;</code></td>
<td><code>app.2025-12-30.log</code></td>
</tr>
<tr>
<td><code>%d&#123;yyyy-MM-dd HH&#125;</code></td>
<td>日期+小时</td>
<td><code>%d&#123;yyyy-MM-dd HH&#125;</code></td>
<td><code>app.2025-12-30-14.log</code></td>
</tr>
<tr>
<td><code>%d&#123;yyyy-MM-dd HH:mm&#125;</code></td>
<td>日期+小时+分钟</td>
<td><code>%d&#123;yyyy-MM-dd HH:mm&#125;</code></td>
<td><code>app.2025-12-30-14-30.log</code></td>
</tr>
<tr>
<td><code>%i</code></td>
<td>索引号</td>
<td><code>%i</code></td>
<td><code>app.0.log</code>, <code>app.1.log</code></td>
</tr>
<tr>
<td><code>.gz</code></td>
<td>压缩后缀</td>
<td><code>.gz</code></td>
<td>自动压缩为 gzip 格式</td>
</tr>
</tbody></table>
<p><strong>组合使用示例：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">logs/app.%d&#123;yyyy-MM-dd&#125;.%i.log.gz</span><br><span class="line">生成：logs/app.2025-12-30.0.log.gz</span><br><span class="line">     logs/app.2025-12-30.1.log.gz</span><br><span class="line">     logs/app.2025-12-29.0.log.gz</span><br></pre></td></tr></table></figure>

<h3 id="5️⃣-轮转策略详解"><a href="#5️⃣-轮转策略详解" class="headerlink" title="5️⃣ 轮转策略详解"></a><strong>5️⃣ 轮转策略详解</strong></h3><h4 id="SizeAndTimeBasedRollingPolicy（大小-时间）"><a href="#SizeAndTimeBasedRollingPolicy（大小-时间）" class="headerlink" title="SizeAndTimeBasedRollingPolicy（大小+时间）"></a><strong>SizeAndTimeBasedRollingPolicy（大小+时间）</strong></h4><p><strong>特点：</strong></p>
<ul>
<li>同时支持按大小和时间轮转</li>
<li>满足任一条件就轮转</li>
<li>文件名包含日期和索引</li>
</ul>
<p><strong>工作原理：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">初始：app.log (0MB)</span><br><span class="line"></span><br><span class="line">写入到 100MB：</span><br><span class="line">app.log → app.2025-12-30.0.log (重命名)</span><br><span class="line">创建新的 app.log</span><br><span class="line"></span><br><span class="line">同一天内再次达到 100MB：</span><br><span class="line">app.log → app.2025-12-30.1.log (重命名)</span><br><span class="line">创建新的 app.log</span><br><span class="line"></span><br><span class="line">第二天（即使文件很小）：</span><br><span class="line">app.log → app.2025-12-31.0.log (按时间轮转)</span><br><span class="line">创建新的 app.log</span><br></pre></td></tr></table></figure>

<h4 id="FixedWindowRollingPolicy（固定窗口）"><a href="#FixedWindowRollingPolicy（固定窗口）" class="headerlink" title="FixedWindowRollingPolicy（固定窗口）"></a><strong>FixedWindowRollingPolicy（固定窗口）</strong></h4><p><strong>特点：</strong></p>
<ul>
<li>只按大小轮转</li>
<li>使用索引号（1, 2, 3…）</li>
<li>超过最大索引后，删除最旧的</li>
</ul>
<p><strong>工作原理：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">maxIndex=3</span><br><span class="line"></span><br><span class="line">app.log → app.1.log</span><br><span class="line">app.1.log → app.2.log</span><br><span class="line">app.2.log → app.3.log</span><br><span class="line">app.3.log → 删除（超过 maxIndex）</span><br></pre></td></tr></table></figure>

<h4 id="TimeBasedRollingPolicy（时间）"><a href="#TimeBasedRollingPolicy（时间）" class="headerlink" title="TimeBasedRollingPolicy（时间）"></a><strong>TimeBasedRollingPolicy（时间）</strong></h4><p><strong>特点：</strong></p>
<ul>
<li>只按时间轮转</li>
<li>文件名包含日期</li>
<li>适合日志量稳定的场景</li>
</ul>
<p><strong>工作原理：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">每天午夜轮转：</span><br><span class="line">app.log → app.2025-12-30.log</span><br><span class="line">创建新的 app.log</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五、Java-应用：Log4j2-日志轮转"><a href="#五、Java-应用：Log4j2-日志轮转" class="headerlink" title="五、Java 应用：Log4j2 日志轮转"></a>五、Java 应用：Log4j2 日志轮转</h2><h3 id="1️⃣-Log4j2-简介"><a href="#1️⃣-Log4j2-简介" class="headerlink" title="1️⃣ Log4j2 简介"></a><strong>1️⃣ Log4j2 简介</strong></h3><p><strong>Log4j2</strong> 是 Apache 的日志框架，也支持强大的日志轮转功能。</p>
<h3 id="2️⃣-配置文件示例-1"><a href="#2️⃣-配置文件示例-1" class="headerlink" title="2️⃣ 配置文件示例"></a><strong>2️⃣ 配置文件示例</strong></h3><h4 id="示例-1：按大小和时间轮转-1"><a href="#示例-1：按大小和时间轮转-1" class="headerlink" title="示例 1：按大小和时间轮转"></a><strong>示例 1：按大小和时间轮转</strong></h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- log4j2.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingFile&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;logs/app.log&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">filePattern</span>=<span class="string">&quot;logs/app-%d&#123;yyyy-MM-dd&#125;-%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 按时间轮转 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> /&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 按大小轮转 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;100MB&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 保留文件数 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">&quot;30&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFile&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="示例-2：按大小轮转-1"><a href="#示例-2：按大小轮转-1" class="headerlink" title="示例 2：按大小轮转"></a><strong>示例 2：按大小轮转</strong></h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;RollingFile&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;logs/app.log&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">filePattern</span>=<span class="string">&quot;logs/app-%i.log.gz&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">PatternLayout</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;100MB&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFile&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3️⃣-常用配置参数"><a href="#3️⃣-常用配置参数" class="headerlink" title="3️⃣ 常用配置参数"></a><strong>3️⃣ 常用配置参数</strong></h3><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>fileName</code></td>
<td>当前日志文件</td>
<td><code>logs/app.log</code></td>
</tr>
<tr>
<td><code>filePattern</code></td>
<td>历史文件命名模式</td>
<td><code>logs/app-%d&#123;yyyy-MM-dd&#125;-%i.log.gz</code></td>
</tr>
<tr>
<td><code>SizeBasedTriggeringPolicy</code></td>
<td>按大小触发</td>
<td><code>&lt;SizeBasedTriggeringPolicy size=&quot;100MB&quot; /&gt;</code></td>
</tr>
<tr>
<td><code>TimeBasedTriggeringPolicy</code></td>
<td>按时间触发</td>
<td><code>&lt;TimeBasedTriggeringPolicy /&gt;</code></td>
</tr>
<tr>
<td><code>max</code></td>
<td>保留文件数</td>
<td><code>max=&quot;30&quot;</code></td>
</tr>
</tbody></table>
<hr>
<h2 id="六、Python-应用：日志轮转"><a href="#六、Python-应用：日志轮转" class="headerlink" title="六、Python 应用：日志轮转"></a>六、Python 应用：日志轮转</h2><h3 id="1️⃣-使用-logging-handlers"><a href="#1️⃣-使用-logging-handlers" class="headerlink" title="1️⃣ 使用 logging.handlers"></a><strong>1️⃣ 使用 logging.handlers</strong></h3><p>Python 标准库提供了日志轮转功能。</p>
<h4 id="示例-1：按大小轮转-1"><a href="#示例-1：按大小轮转-1" class="headerlink" title="示例 1：按大小轮转"></a><strong>示例 1：按大小轮转</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> logging.handlers <span class="keyword">import</span> RotatingFileHandler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建轮转处理器</span></span><br><span class="line">handler = RotatingFileHandler(</span><br><span class="line">    <span class="string">&#x27;app.log&#x27;</span>,</span><br><span class="line">    maxBytes=<span class="number">100</span> * <span class="number">1024</span> * <span class="number">1024</span>,  <span class="comment"># 100MB</span></span><br><span class="line">    backupCount=<span class="number">10</span>  <span class="comment"># 保留 10 个备份文件</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置格式</span></span><br><span class="line">formatter = logging.Formatter(</span><br><span class="line">    <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span></span><br><span class="line">)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 logger</span></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;myapp&#x27;</span>)</span><br><span class="line">logger.setLevel(logging.INFO)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用</span></span><br><span class="line">logger.info(<span class="string">&#x27;This is a log message&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="示例-2：按时间轮转-1"><a href="#示例-2：按时间轮转-1" class="headerlink" title="示例 2：按时间轮转"></a><strong>示例 2：按时间轮转</strong></h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> logging.handlers <span class="keyword">import</span> TimedRotatingFileHandler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建时间轮转处理器</span></span><br><span class="line">handler = TimedRotatingFileHandler(</span><br><span class="line">    <span class="string">&#x27;app.log&#x27;</span>,</span><br><span class="line">    when=<span class="string">&#x27;midnight&#x27;</span>,  <span class="comment"># 每天午夜轮转</span></span><br><span class="line">    interval=<span class="number">1</span>,  <span class="comment"># 间隔 1 天</span></span><br><span class="line">    backupCount=<span class="number">30</span>  <span class="comment"># 保留 30 天</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">formatter = logging.Formatter(</span><br><span class="line">    <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span></span><br><span class="line">)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;myapp&#x27;</span>)</span><br><span class="line">logger.setLevel(logging.INFO)</span><br><span class="line">logger.addHandler(handler)</span><br></pre></td></tr></table></figure>

<h3 id="2️⃣-时间轮转参数"><a href="#2️⃣-时间轮转参数" class="headerlink" title="2️⃣ 时间轮转参数"></a><strong>2️⃣ 时间轮转参数</strong></h3><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>when=&#39;S&#39;</code></td>
<td>秒</td>
<td><code>when=&#39;S&#39;, interval=60</code></td>
</tr>
<tr>
<td><code>when=&#39;M&#39;</code></td>
<td>分钟</td>
<td><code>when=&#39;M&#39;, interval=60</code></td>
</tr>
<tr>
<td><code>when=&#39;H&#39;</code></td>
<td>小时</td>
<td><code>when=&#39;H&#39;, interval=24</code></td>
</tr>
<tr>
<td><code>when=&#39;D&#39;</code></td>
<td>天</td>
<td><code>when=&#39;D&#39;, interval=1</code></td>
</tr>
<tr>
<td><code>when=&#39;midnight&#39;</code></td>
<td>每天午夜</td>
<td><code>when=&#39;midnight&#39;</code></td>
</tr>
<tr>
<td><code>when=&#39;W0&#39;</code></td>
<td>每周一</td>
<td><code>when=&#39;W0&#39;</code></td>
</tr>
</tbody></table>
<hr>
<h2 id="七、Node-js-应用：日志轮转"><a href="#七、Node-js-应用：日志轮转" class="headerlink" title="七、Node.js 应用：日志轮转"></a>七、Node.js 应用：日志轮转</h2><h3 id="1️⃣-使用-winston-daily-rotate-file"><a href="#1️⃣-使用-winston-daily-rotate-file" class="headerlink" title="1️⃣ 使用 winston-daily-rotate-file"></a><strong>1️⃣ 使用 winston-daily-rotate-file</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install winston winston-daily-rotate-file</span><br></pre></td></tr></table></figure>

<h4 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a><strong>配置示例</strong></h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> winston = <span class="built_in">require</span>(<span class="string">&#x27;winston&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DailyRotateFile</span> = <span class="built_in">require</span>(<span class="string">&#x27;winston-daily-rotate-file&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logger = winston.<span class="title function_">createLogger</span>(&#123;</span><br><span class="line">    <span class="attr">level</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">    <span class="attr">format</span>: winston.<span class="property">format</span>.<span class="title function_">combine</span>(</span><br><span class="line">        winston.<span class="property">format</span>.<span class="title function_">timestamp</span>(),</span><br><span class="line">        winston.<span class="property">format</span>.<span class="title function_">json</span>()</span><br><span class="line">    ),</span><br><span class="line">    <span class="attr">transports</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DailyRotateFile</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;logs/app-%DATE%.log&#x27;</span>,</span><br><span class="line">            <span class="attr">datePattern</span>: <span class="string">&#x27;YYYY-MM-DD&#x27;</span>,</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="string">&#x27;100m&#x27;</span>,</span><br><span class="line">            <span class="attr">maxFiles</span>: <span class="string">&#x27;30d&#x27;</span>,  <span class="comment">// 保留 30 天</span></span><br><span class="line">            <span class="attr">zippedArchive</span>: <span class="literal">true</span>  <span class="comment">// 压缩旧日志</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">logger.<span class="title function_">info</span>(<span class="string">&#x27;This is a log message&#x27;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="八、最佳实践"><a href="#八、最佳实践" class="headerlink" title="八、最佳实践"></a>八、最佳实践</h2><h3 id="1️⃣-轮转策略选择"><a href="#1️⃣-轮转策略选择" class="headerlink" title="1️⃣ 轮转策略选择"></a><strong>1️⃣ 轮转策略选择</strong></h3><h4 id="按大小轮转-1"><a href="#按大小轮转-1" class="headerlink" title="按大小轮转"></a><strong>按大小轮转</strong></h4><ul>
<li>✅ <strong>适合</strong>：日志量不固定，可能突然增长</li>
<li>✅ <strong>优点</strong>：防止单个文件过大</li>
<li>⚠️ <strong>注意</strong>：需要合理设置大小阈值</li>
</ul>
<h4 id="按时间轮转-1"><a href="#按时间轮转-1" class="headerlink" title="按时间轮转"></a><strong>按时间轮转</strong></h4><ul>
<li>✅ <strong>适合</strong>：日志量相对稳定</li>
<li>✅ <strong>优点</strong>：便于按时间查找日志</li>
<li>⚠️ <strong>注意</strong>：需要合理设置保留天数</li>
</ul>
<h4 id="按大小-时间轮转-1"><a href="#按大小-时间轮转-1" class="headerlink" title="按大小+时间轮转"></a><strong>按大小+时间轮转</strong></h4><ul>
<li>✅ <strong>适合</strong>：生产环境推荐</li>
<li>✅ <strong>优点</strong>：兼顾大小和时间</li>
<li>⚠️ <strong>注意</strong>：配置相对复杂</li>
</ul>
<h3 id="2️⃣-保留策略"><a href="#2️⃣-保留策略" class="headerlink" title="2️⃣ 保留策略"></a><strong>2️⃣ 保留策略</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 推荐配置</span></span><br><span class="line">保留天数：30 天（业务日志）</span><br><span class="line">保留大小：10GB（总大小限制）</span><br><span class="line">保留数量：10-30 个文件</span><br></pre></td></tr></table></figure>

<h3 id="3️⃣-压缩策略"><a href="#3️⃣-压缩策略" class="headerlink" title="3️⃣ 压缩策略"></a><strong>3️⃣ 压缩策略</strong></h3><ul>
<li>✅ <strong>启用压缩</strong>：节省 70-90% 的磁盘空间</li>
<li>✅ <strong>延迟压缩</strong>：压缩前一个文件，当前文件不压缩</li>
<li>⚠️ <strong>注意</strong>：压缩会增加 CPU 使用，但节省磁盘空间</li>
</ul>
<h3 id="4️⃣-文件命名规范"><a href="#4️⃣-文件命名规范" class="headerlink" title="4️⃣ 文件命名规范"></a><strong>4️⃣ 文件命名规范</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 推荐命名格式</span></span><br><span class="line">app-2025-12-30-0.log.gz</span><br><span class="line">app-2025-12-30-1.log.gz</span><br><span class="line">app-2025-12-30-2.log.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 包含信息</span></span><br><span class="line">- 应用名</span><br><span class="line">- 日期</span><br><span class="line">- 索引号</span><br><span class="line">- 压缩后缀</span><br></pre></td></tr></table></figure>

<h3 id="5️⃣-目录结构"><a href="#5️⃣-目录结构" class="headerlink" title="5️⃣ 目录结构"></a><strong>5️⃣ 目录结构</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">logs/</span><br><span class="line">├── app.log              <span class="comment"># 当前日志</span></span><br><span class="line">├── app-2025-12-30-0.log.gz</span><br><span class="line">├── app-2025-12-30-1.log.gz</span><br><span class="line">├── app-2025-12-29-0.log.gz</span><br><span class="line">└── archive/             <span class="comment"># 归档目录（可选）</span></span><br><span class="line">    └── app-2025-12-01-0.log.gz</span><br></pre></td></tr></table></figure>

<h3 id="6️⃣-监控和告警"><a href="#6️⃣-监控和告警" class="headerlink" title="6️⃣ 监控和告警"></a><strong>6️⃣ 监控和告警</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 监控日志目录大小</span></span><br><span class="line"><span class="built_in">du</span> -sh /var/log/myapp/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监控日志文件数量</span></span><br><span class="line"><span class="built_in">ls</span> -1 /var/log/myapp/*.<span class="built_in">log</span>* | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置告警</span></span><br><span class="line"><span class="keyword">if</span> [ $(<span class="built_in">du</span> -sm /var/log/myapp | <span class="built_in">cut</span> -f1) -gt 10000 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Log directory exceeds 10GB&quot;</span> | mail -s <span class="string">&quot;Alert&quot;</span> admin@example.com</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="7️⃣-应用重启处理"><a href="#7️⃣-应用重启处理" class="headerlink" title="7️⃣ 应用重启处理"></a><strong>7️⃣ 应用重启处理</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># logrotate postrotate 脚本示例</span></span><br><span class="line">postrotate</span><br><span class="line">    <span class="comment"># 发送信号让应用重新打开日志文件</span></span><br><span class="line">    /bin/kill -HUP `<span class="built_in">cat</span> /var/run/myapp.pid 2&gt; /dev/null` 2&gt; /dev/null || <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 或者使用 systemd</span></span><br><span class="line">    systemctl reload myapp || <span class="literal">true</span></span><br><span class="line">endscript</span><br></pre></td></tr></table></figure>

<h3 id="8️⃣-常见问题排查"><a href="#8️⃣-常见问题排查" class="headerlink" title="8️⃣ 常见问题排查"></a><strong>8️⃣ 常见问题排查</strong></h3><h4 id="问题-1：日志轮转后应用还在写旧文件"><a href="#问题-1：日志轮转后应用还在写旧文件" class="headerlink" title="问题 1：日志轮转后应用还在写旧文件"></a><strong>问题 1：日志轮转后应用还在写旧文件</strong></h4><p><strong>原因：</strong> 应用没有重新打开日志文件</p>
<p><strong>解决：</strong> 在 postrotate 脚本中发送信号让应用重新打开文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">postrotate</span><br><span class="line">    /bin/kill -HUP `<span class="built_in">cat</span> /var/run/myapp.pid`</span><br><span class="line">endscript</span><br></pre></td></tr></table></figure>

<h4 id="问题-2：磁盘空间仍然不足"><a href="#问题-2：磁盘空间仍然不足" class="headerlink" title="问题 2：磁盘空间仍然不足"></a><strong>问题 2：磁盘空间仍然不足</strong></h4><p><strong>原因：</strong> 保留策略设置过大</p>
<p><strong>解决：</strong> 调整保留天数或总大小限制</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rotate 7          <span class="comment"># 减少保留天数</span></span><br><span class="line">totalSizeCap 5GB  <span class="comment"># 设置总大小限制</span></span><br></pre></td></tr></table></figure>

<h4 id="问题-3：轮转不生效"><a href="#问题-3：轮转不生效" class="headerlink" title="问题 3：轮转不生效"></a><strong>问题 3：轮转不生效</strong></h4><p><strong>原因：</strong> 配置文件语法错误或权限问题</p>
<p><strong>解决：</strong> 检查配置和权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 测试配置</span></span><br><span class="line">logrotate -d /etc/logrotate.d/myapp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查权限</span></span><br><span class="line"><span class="built_in">ls</span> -l /var/log/myapp/</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="九、完整配置示例"><a href="#九、完整配置示例" class="headerlink" title="九、完整配置示例"></a>九、完整配置示例</h2><h3 id="1️⃣-logrotate-完整配置"><a href="#1️⃣-logrotate-完整配置" class="headerlink" title="1️⃣ logrotate 完整配置"></a><strong>1️⃣ logrotate 完整配置</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /etc/logrotate.d/myapp</span></span><br><span class="line">/var/log/myapp/*.<span class="built_in">log</span> &#123;</span><br><span class="line">    <span class="comment"># 轮转策略</span></span><br><span class="line">    size 500M</span><br><span class="line">    daily</span><br><span class="line">    rotate 30</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 压缩</span></span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    compresscmd /bin/gzip</span><br><span class="line">    uncompresscmd /bin/gunzip</span><br><span class="line">    compressext .gz</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 文件处理</span></span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    create 0644 app app</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 日期后缀</span></span><br><span class="line">    dateext</span><br><span class="line">    dateformat -%Y%m%d</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 脚本</span></span><br><span class="line">    sharedscripts</span><br><span class="line">    postrotate</span><br><span class="line">        /bin/kill -HUP `<span class="built_in">cat</span> /var/run/myapp.pid 2&gt; /dev/null` 2&gt; /dev/null || <span class="literal">true</span></span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2️⃣-Logback-完整配置"><a href="#2️⃣-Logback-完整配置" class="headerlink" title="2️⃣ Logback 完整配置"></a><strong>2️⃣ Logback 完整配置</strong></h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_HOME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/var/log/myapp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/app.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/app.%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>500MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">totalSizeCap</span>&gt;</span>10GB<span class="tag">&lt;/<span class="name">totalSizeCap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;ERROR_FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/error.%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>90<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">totalSizeCap</span>&gt;</span>5GB<span class="tag">&lt;/<span class="name">totalSizeCap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ERROR_FILE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="十、总结"><a href="#十、总结" class="headerlink" title="十、总结"></a>十、总结</h2><h3 id="核心要点"><a href="#核心要点" class="headerlink" title="核心要点"></a><strong>核心要点</strong></h3><ol>
<li><strong>日志轮转是必须的</strong>：防止日志文件无限增长</li>
<li><strong>选择合适的策略</strong>：按大小、按时间或两者结合</li>
<li><strong>合理设置保留策略</strong>：平衡存储成本和历史追溯需求</li>
<li><strong>启用压缩</strong>：大幅节省磁盘空间</li>
<li><strong>处理应用重启</strong>：确保轮转后应用正常写入</li>
</ol>
<h3 id="推荐配置"><a href="#推荐配置" class="headerlink" title="推荐配置"></a><strong>推荐配置</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 通用推荐</span></span><br><span class="line">轮转条件：大小 500MB 或 每天</span><br><span class="line">保留策略：30 天或 10GB</span><br><span class="line">压缩：启用</span><br><span class="line">文件命名：包含日期和索引</span><br></pre></td></tr></table></figure>

<h3 id="工具选择"><a href="#工具选择" class="headerlink" title="工具选择"></a><strong>工具选择</strong></h3><table>
<thead>
<tr>
<th>场景</th>
<th>推荐工具</th>
</tr>
</thead>
<tbody><tr>
<td>Linux 系统日志</td>
<td>logrotate</td>
</tr>
<tr>
<td>Java 应用</td>
<td>Logback &#x2F; Log4j2</td>
</tr>
<tr>
<td>Python 应用</td>
<td>logging.handlers</td>
</tr>
<tr>
<td>Node.js 应用</td>
<td>winston-daily-rotate-file</td>
</tr>
</tbody></table>
<hr>
<h3 id="💡-延伸阅读"><a href="#💡-延伸阅读" class="headerlink" title="💡 延伸阅读"></a>💡 延伸阅读</h3><ul>
<li><a target="_blank" rel="noopener" href="https://linux.die.net/man/8/logrotate">logrotate 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="http://logback.qos.ch/documentation.html">Logback 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://logging.apache.org/log4j/2.x/manual/index.html">Log4j2 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/logging.handlers.html">Python logging 文档</a></li>
</ul>
<hr>
<p><strong>如果你觉得这篇文章有用，欢迎收藏！下次遇到日志管理问题时，拿出来对照一下，就能快速配置专业的日志轮转策略。</strong></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://linn0813.github.io">yuxiaoling</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://linn0813.github.io/2025/12/31/2025-12-31-log-rotation-guide/">https://linn0813.github.io/2025/12/31/2025-12-31-log-rotation-guide/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">版权所有，转载请注明出处。</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/">日志管理</a><a class="post-meta__tags" href="/tags/%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC/">日志轮转</a><a class="post-meta__tags" href="/tags/logrotate/">logrotate</a><a class="post-meta__tags" href="/tags/logback/">logback</a><a class="post-meta__tags" href="/tags/log4j/">log4j</a><a class="post-meta__tags" href="/tags/%E8%BF%90%E7%BB%B4/">运维</a></div><div class="post-share"><div class="social-share" data-image="/img/log-rotation-guide.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/12/30/2025-12-30-third-party-callback-guide/" title="🔄 第三方平台回调接口完整指南：从 OAuth 授权到 Webhook 设计"><img class="cover" src="/img/callback-guide.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post" loading='lazy'><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">🔄 第三方平台回调接口完整指南：从 OAuth 授权到 Webhook 设计</div></div><div class="info-2"><div class="info-item-1">在对接飞书、企业微信、GitHub、支付宝等第三方平台时，很多人第一次写授权模块都会卡在一个问题上：  “为什么我本地服务跑得好好的，授权却一直失败？”  答案，往往就藏在一个你可能从未系统学习过的概念里： 👉 公网回调 &amp; 内网穿透 这篇文章将从 问题场景 → 核心原理 → 解决方案 → 设计模式 → 工程实践，带你一次性吃透第三方平台回调接口的设计与实现。  一、问题从哪里来？——一个真实的开发场景典型场景：飞书 OAuth 授权我们先看一个非常典型的飞书 OAuth 授权需求：  用户在飞书点击「授权」 → 飞书校验成功 →飞书服务器回调你的接口，携带授权 code  于是你写了一个回调接口： POST /api/test/ai-test-case/feishu/oauth-callback  本地服务运行在： http://127.0.0.1:5003  然后你把这个地址配置进飞书后台。 结果发现： ❌ 授权失败❌ 回调接口完全没被调用❌ 日志一片安静 问题不是你代码写错了，而是：  👉...</div></div></div></a><a class="pagination-related" href="/2026/01/01/2026-01-01-testing-standards-guide/" title="📐 测试标准完全指南：从 ISO/IEC 到企业实践，构建专业的测试体系"><img class="cover" src="/img/testing-standards-guide.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post" loading='lazy'><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">📐 测试标准完全指南：从 ISO/IEC 到企业实践，构建专业的测试体系</div></div><div class="info-2"><div class="info-item-1">你有没有遇到过这样的困惑：  “测试到底要做到什么程度才算合格？”“为什么不同公司的测试流程差异这么大？”“有没有统一的测试标准可以参考？”  这些问题，都可以通过**测试标准（Testing Standards）**来解决。 这篇文章将从基础概念 → 国际标准 → 行业标准 → 企业实践，带你系统掌握测试标准的完整知识体系。  一、基础概念：什么是测试标准？1️⃣ 测试标准的定义测试标准（Testing Standards） 是一套规范化的测试活动指南和准则，用于：  统一测试流程：定义测试活动的标准流程 规范测试行为：明确测试人员应该做什么、怎么做 保证测试质量：确保测试活动的一致性和有效性 促进沟通协作：提供共同的语言和框架  2️⃣ 为什么需要测试标准？问题场景 1：测试流程混乱团队 A：先写用例，再执行测试团队 B：直接测试，发现问题再补用例团队 C：用例和执行混在一起结果：无法统一管理，效率低下  问题场景...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="utterances-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/ loading='lazy'></div><div class="author-info-name">yuxiaoling</div><div class="author-info-description">分享软件测试学习、实战经验和踩坑历程</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">94</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">363</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Linn0813"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Linn0813" target="_blank" title="GitHub"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:yuxiaoling.yxl@qq.com" target="_blank" title="Email"><i class="fa fa-envelope-open-text"></i></a><a class="social-icon" href="javascript:alert('微信公众号：Linn的技术笔记')" target="_blank" title="微信"><i class="fab fa-weixin"></i></a><a class="social-icon" href="https://weibo.com/Linn0813" target="_blank" title="微博"><i class="fab fa-weibo"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">下雨就不想上班 / 出太阳也不想上班</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%97%AE%E9%A2%98%E5%9C%BA%E6%99%AF%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">一、问题场景：为什么需要日志轮转？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-%E5%85%B8%E5%9E%8B%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.</span> <span class="toc-text">1️⃣ 典型问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-1%EF%BC%9A%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E8%A2%AB%E5%8D%A0%E6%BB%A1"><span class="toc-number">1.1.1.</span> <span class="toc-text">问题 1：磁盘空间被占满</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-2%EF%BC%9A%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E8%BF%87%E5%A4%A7%EF%BC%8C%E9%9A%BE%E4%BB%A5%E5%A4%84%E7%90%86"><span class="toc-number">1.1.2.</span> <span class="toc-text">问题 2：日志文件过大，难以处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-3%EF%BC%9A%E5%8E%86%E5%8F%B2%E6%97%A5%E5%BF%97%E4%B8%A2%E5%A4%B1"><span class="toc-number">1.1.3.</span> <span class="toc-text">问题 3：历史日志丢失</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC%E7%9A%84%E4%BB%B7%E5%80%BC"><span class="toc-number">1.2.</span> <span class="toc-text">2️⃣ 日志轮转的价值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E7%A7%91%E6%99%AE%EF%BC%9A%E7%90%86%E8%A7%A3%E6%97%A5%E5%BF%97%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.</span> <span class="toc-text">二、基础概念科普：理解日志和文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">1️⃣ 什么是日志文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E4%BC%9A%E4%B8%8D%E6%96%AD%E5%A2%9E%E9%95%BF"><span class="toc-number">2.2.</span> <span class="toc-text">2️⃣ 为什么日志文件会不断增长</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3-%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%EF%BC%88File-Descriptor%EF%BC%89%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">2.3.</span> <span class="toc-text">3️⃣ 文件描述符（File Descriptor）的概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%B8%8F%E2%83%A3-%E6%97%A5%E5%BF%97%E5%86%99%E5%85%A5%E7%9A%84%E6%9C%BA%E5%88%B6"><span class="toc-number">2.4.</span> <span class="toc-text">4️⃣ 日志写入的机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%B8%8F%E2%83%A3-%E6%96%87%E4%BB%B6%E9%87%8D%E5%91%BD%E5%90%8D%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">2.5.</span> <span class="toc-text">5️⃣ 文件重命名的原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%B8%8F%E2%83%A3-%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC"><span class="toc-number">2.6.</span> <span class="toc-text">6️⃣ 什么是日志轮转</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%B8%8F%E2%83%A3-%E8%BD%AE%E8%BD%AC%E8%BF%87%E7%A8%8B%E8%AF%A6%E7%BB%86%E7%A4%BA%E6%84%8F"><span class="toc-number">2.7.</span> <span class="toc-text">7️⃣ 轮转过程详细示意</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%B8%8F%E2%83%A3-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E9%87%8D%E6%96%B0%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6"><span class="toc-number">2.8.</span> <span class="toc-text">8️⃣ 为什么需要重新打开文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%B8%8F%E2%83%A3-%E8%BD%AE%E8%BD%AC%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.9.</span> <span class="toc-text">9️⃣ 轮转触发条件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E6%97%B6%E9%97%B4%E8%BD%AE%E8%BD%AC"><span class="toc-number">2.9.1.</span> <span class="toc-text">按时间轮转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E5%A4%A7%E5%B0%8F%E8%BD%AE%E8%BD%AC"><span class="toc-number">2.9.2.</span> <span class="toc-text">按大小轮转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E5%A4%A7%E5%B0%8F-%E6%97%B6%E9%97%B4%E8%BD%AE%E8%BD%AC"><span class="toc-number">2.9.3.</span> <span class="toc-text">按大小+时间轮转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91"><span class="toc-number">2.9.4.</span> <span class="toc-text">手动触发</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%94%9F-%E8%BD%AE%E8%BD%AC%E5%90%8E%E7%9A%84%E5%A4%84%E7%90%86%E6%93%8D%E4%BD%9C"><span class="toc-number">2.10.</span> <span class="toc-text">🔟 轮转后的处理操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9%EF%BC%88Compress%EF%BC%89"><span class="toc-number">2.10.1.</span> <span class="toc-text">压缩（Compress）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%92%E6%A1%A3%EF%BC%88Archive%EF%BC%89"><span class="toc-number">2.10.2.</span> <span class="toc-text">归档（Archive）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%EF%BC%88Delete%EF%BC%89"><span class="toc-number">2.10.3.</span> <span class="toc-text">删除（Delete）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%EF%BC%88Notification%EF%BC%89"><span class="toc-number">2.10.4.</span> <span class="toc-text">通知（Notification）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%EF%BC%9A%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">三、核心概念：日志轮转的原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC%E7%9A%84%E5%AE%8C%E6%95%B4%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">1️⃣ 日志轮转的完整流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-%E8%BD%AE%E8%BD%AC%E7%AD%96%E7%95%A5%E5%AF%B9%E6%AF%94"><span class="toc-number">3.2.</span> <span class="toc-text">2️⃣ 轮转策略对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3-%E4%BF%9D%E7%95%99%E7%AD%96%E7%95%A5"><span class="toc-number">3.3.</span> <span class="toc-text">3️⃣ 保留策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Linux-%E7%B3%BB%E7%BB%9F%E5%B7%A5%E5%85%B7%EF%BC%9Alogrotate"><span class="toc-number">4.</span> <span class="toc-text">四、Linux 系统工具：logrotate</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-logrotate-%E7%AE%80%E4%BB%8B"><span class="toc-number">4.1.</span> <span class="toc-text">1️⃣ logrotate 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE%E5%92%8C%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.</span> <span class="toc-text">2️⃣ 配置文件位置和结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE"><span class="toc-number">4.2.1.</span> <span class="toc-text">配置文件位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.2.</span> <span class="toc-text">配置文件结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">4.2.3.</span> <span class="toc-text">配置文件的优先级</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3-%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.3.</span> <span class="toc-text">3️⃣ 基本配置示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1%EF%BC%9A%E6%8C%89%E5%A4%A7%E5%B0%8F%E8%BD%AE%E8%BD%AC"><span class="toc-number">4.3.1.</span> <span class="toc-text">示例 1：按大小轮转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2%EF%BC%9A%E6%8C%89%E6%97%B6%E9%97%B4%E8%BD%AE%E8%BD%AC"><span class="toc-number">4.3.2.</span> <span class="toc-text">示例 2：按时间轮转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-3%EF%BC%9A%E6%8C%89%E5%A4%A7%E5%B0%8F%E5%92%8C%E6%97%B6%E9%97%B4%E8%BD%AE%E8%BD%AC"><span class="toc-number">4.3.3.</span> <span class="toc-text">示例 3：按大小和时间轮转</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%B8%8F%E2%83%A3-%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3"><span class="toc-number">4.4.</span> <span class="toc-text">4️⃣ 常用配置参数详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%B8%8F%E2%83%A3-%E9%87%8D%E8%A6%81%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3"><span class="toc-number">4.5.</span> <span class="toc-text">5️⃣ 重要参数详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#compress-vs-delaycompress"><span class="toc-number">4.5.1.</span> <span class="toc-text">compress vs delaycompress</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#create-%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3"><span class="toc-number">4.5.2.</span> <span class="toc-text">create 参数详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#postrotate-%E8%84%9A%E6%9C%AC%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">4.5.3.</span> <span class="toc-text">postrotate 脚本的作用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%B8%8F%E2%83%A3-%E6%B5%8B%E8%AF%95%E5%92%8C%E8%B0%83%E8%AF%95"><span class="toc-number">4.6.</span> <span class="toc-text">5️⃣ 测试和调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%B8%8F%E2%83%A3-logrotate-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">4.7.</span> <span class="toc-text">6️⃣ logrotate 的工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6"><span class="toc-number">4.7.1.</span> <span class="toc-text">执行机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA"><span class="toc-number">4.7.2.</span> <span class="toc-text">执行时机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-number">4.7.3.</span> <span class="toc-text">状态文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%97%A5%E5%BF%97"><span class="toc-number">4.7.4.</span> <span class="toc-text">执行日志</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Java-%E5%BA%94%E7%94%A8%EF%BC%9ALogback-%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC"><span class="toc-number">5.</span> <span class="toc-text">五、Java 应用：Logback 日志轮转</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-Logback-%E7%AE%80%E4%BB%8B"><span class="toc-number">5.1.</span> <span class="toc-text">1️⃣ Logback 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.2.</span> <span class="toc-text">2️⃣ 配置文件示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1%EF%BC%9A%E6%8C%89%E5%A4%A7%E5%B0%8F%E5%92%8C%E6%97%B6%E9%97%B4%E8%BD%AE%E8%BD%AC"><span class="toc-number">5.2.1.</span> <span class="toc-text">示例 1：按大小和时间轮转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2%EF%BC%9A%E6%8C%89%E5%A4%A7%E5%B0%8F%E8%BD%AE%E8%BD%AC"><span class="toc-number">5.2.2.</span> <span class="toc-text">示例 2：按大小轮转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-3%EF%BC%9A%E6%8C%89%E6%97%B6%E9%97%B4%E8%BD%AE%E8%BD%AC"><span class="toc-number">5.2.3.</span> <span class="toc-text">示例 3：按时间轮转</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3-%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3"><span class="toc-number">5.3.</span> <span class="toc-text">3️⃣ 常用配置参数详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%B8%8F%E2%83%A3-%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E8%AF%B4%E6%98%8E"><span class="toc-number">5.4.</span> <span class="toc-text">4️⃣ 日期格式说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%B8%8F%E2%83%A3-%E8%BD%AE%E8%BD%AC%E7%AD%96%E7%95%A5%E8%AF%A6%E8%A7%A3"><span class="toc-number">5.5.</span> <span class="toc-text">5️⃣ 轮转策略详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SizeAndTimeBasedRollingPolicy%EF%BC%88%E5%A4%A7%E5%B0%8F-%E6%97%B6%E9%97%B4%EF%BC%89"><span class="toc-number">5.5.1.</span> <span class="toc-text">SizeAndTimeBasedRollingPolicy（大小+时间）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#FixedWindowRollingPolicy%EF%BC%88%E5%9B%BA%E5%AE%9A%E7%AA%97%E5%8F%A3%EF%BC%89"><span class="toc-number">5.5.2.</span> <span class="toc-text">FixedWindowRollingPolicy（固定窗口）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TimeBasedRollingPolicy%EF%BC%88%E6%97%B6%E9%97%B4%EF%BC%89"><span class="toc-number">5.5.3.</span> <span class="toc-text">TimeBasedRollingPolicy（时间）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Java-%E5%BA%94%E7%94%A8%EF%BC%9ALog4j2-%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC"><span class="toc-number">6.</span> <span class="toc-text">五、Java 应用：Log4j2 日志轮转</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-Log4j2-%E7%AE%80%E4%BB%8B"><span class="toc-number">6.1.</span> <span class="toc-text">1️⃣ Log4j2 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">6.2.</span> <span class="toc-text">2️⃣ 配置文件示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1%EF%BC%9A%E6%8C%89%E5%A4%A7%E5%B0%8F%E5%92%8C%E6%97%B6%E9%97%B4%E8%BD%AE%E8%BD%AC-1"><span class="toc-number">6.2.1.</span> <span class="toc-text">示例 1：按大小和时间轮转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2%EF%BC%9A%E6%8C%89%E5%A4%A7%E5%B0%8F%E8%BD%AE%E8%BD%AC-1"><span class="toc-number">6.2.2.</span> <span class="toc-text">示例 2：按大小轮转</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3-%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-number">6.3.</span> <span class="toc-text">3️⃣ 常用配置参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Python-%E5%BA%94%E7%94%A8%EF%BC%9A%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC"><span class="toc-number">7.</span> <span class="toc-text">六、Python 应用：日志轮转</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-%E4%BD%BF%E7%94%A8-logging-handlers"><span class="toc-number">7.1.</span> <span class="toc-text">1️⃣ 使用 logging.handlers</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1%EF%BC%9A%E6%8C%89%E5%A4%A7%E5%B0%8F%E8%BD%AE%E8%BD%AC-1"><span class="toc-number">7.1.1.</span> <span class="toc-text">示例 1：按大小轮转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2%EF%BC%9A%E6%8C%89%E6%97%B6%E9%97%B4%E8%BD%AE%E8%BD%AC-1"><span class="toc-number">7.1.2.</span> <span class="toc-text">示例 2：按时间轮转</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-%E6%97%B6%E9%97%B4%E8%BD%AE%E8%BD%AC%E5%8F%82%E6%95%B0"><span class="toc-number">7.2.</span> <span class="toc-text">2️⃣ 时间轮转参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81Node-js-%E5%BA%94%E7%94%A8%EF%BC%9A%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC"><span class="toc-number">8.</span> <span class="toc-text">七、Node.js 应用：日志轮转</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-%E4%BD%BF%E7%94%A8-winston-daily-rotate-file"><span class="toc-number">8.1.</span> <span class="toc-text">1️⃣ 使用 winston-daily-rotate-file</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">8.1.1.</span> <span class="toc-text">配置示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">9.</span> <span class="toc-text">八、最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-%E8%BD%AE%E8%BD%AC%E7%AD%96%E7%95%A5%E9%80%89%E6%8B%A9"><span class="toc-number">9.1.</span> <span class="toc-text">1️⃣ 轮转策略选择</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E5%A4%A7%E5%B0%8F%E8%BD%AE%E8%BD%AC-1"><span class="toc-number">9.1.1.</span> <span class="toc-text">按大小轮转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E6%97%B6%E9%97%B4%E8%BD%AE%E8%BD%AC-1"><span class="toc-number">9.1.2.</span> <span class="toc-text">按时间轮转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%89%E5%A4%A7%E5%B0%8F-%E6%97%B6%E9%97%B4%E8%BD%AE%E8%BD%AC-1"><span class="toc-number">9.1.3.</span> <span class="toc-text">按大小+时间轮转</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-%E4%BF%9D%E7%95%99%E7%AD%96%E7%95%A5"><span class="toc-number">9.2.</span> <span class="toc-text">2️⃣ 保留策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%B8%8F%E2%83%A3-%E5%8E%8B%E7%BC%A9%E7%AD%96%E7%95%A5"><span class="toc-number">9.3.</span> <span class="toc-text">3️⃣ 压缩策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%B8%8F%E2%83%A3-%E6%96%87%E4%BB%B6%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="toc-number">9.4.</span> <span class="toc-text">4️⃣ 文件命名规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%B8%8F%E2%83%A3-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">9.5.</span> <span class="toc-text">5️⃣ 目录结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%B8%8F%E2%83%A3-%E7%9B%91%E6%8E%A7%E5%92%8C%E5%91%8A%E8%AD%A6"><span class="toc-number">9.6.</span> <span class="toc-text">6️⃣ 监控和告警</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%B8%8F%E2%83%A3-%E5%BA%94%E7%94%A8%E9%87%8D%E5%90%AF%E5%A4%84%E7%90%86"><span class="toc-number">9.7.</span> <span class="toc-text">7️⃣ 应用重启处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%B8%8F%E2%83%A3-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="toc-number">9.8.</span> <span class="toc-text">8️⃣ 常见问题排查</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-1%EF%BC%9A%E6%97%A5%E5%BF%97%E8%BD%AE%E8%BD%AC%E5%90%8E%E5%BA%94%E7%94%A8%E8%BF%98%E5%9C%A8%E5%86%99%E6%97%A7%E6%96%87%E4%BB%B6"><span class="toc-number">9.8.1.</span> <span class="toc-text">问题 1：日志轮转后应用还在写旧文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-2%EF%BC%9A%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E4%BB%8D%E7%84%B6%E4%B8%8D%E8%B6%B3"><span class="toc-number">9.8.2.</span> <span class="toc-text">问题 2：磁盘空间仍然不足</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-3%EF%BC%9A%E8%BD%AE%E8%BD%AC%E4%B8%8D%E7%94%9F%E6%95%88"><span class="toc-number">9.8.3.</span> <span class="toc-text">问题 3：轮转不生效</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="toc-number">10.</span> <span class="toc-text">九、完整配置示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%B8%8F%E2%83%A3-logrotate-%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE"><span class="toc-number">10.1.</span> <span class="toc-text">1️⃣ logrotate 完整配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%B8%8F%E2%83%A3-Logback-%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE"><span class="toc-number">10.2.</span> <span class="toc-text">2️⃣ Logback 完整配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">11.</span> <span class="toc-text">十、总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E8%A6%81%E7%82%B9"><span class="toc-number">11.1.</span> <span class="toc-text">核心要点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E9%85%8D%E7%BD%AE"><span class="toc-number">11.2.</span> <span class="toc-text">推荐配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E9%80%89%E6%8B%A9"><span class="toc-number">11.3.</span> <span class="toc-text">工具选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%92%A1-%E5%BB%B6%E4%BC%B8%E9%98%85%E8%AF%BB"><span class="toc-number">11.4.</span> <span class="toc-text">💡 延伸阅读</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/07/2026-01-07-performance-monitoring-dashboard-guide/" title="📊 压测时，我是如何一步步「读懂」性能监控面板的"><img src="/img/performance-monitoring-dashboard-guide.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="📊 压测时，我是如何一步步「读懂」性能监控面板的"/ loading='lazy'></a><div class="content"><a class="title" href="/2026/01/07/2026-01-07-performance-monitoring-dashboard-guide/" title="📊 压测时，我是如何一步步「读懂」性能监控面板的">📊 压测时，我是如何一步步「读懂」性能监控面板的</a><time datetime="2026-01-07T12:00:00.000Z" title="发表于 2026-01-07 20:00:00">2026-01-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/06/2026-01-06-server-performance-troubleshooting-guide/" title="🚀 服务器性能问题排查完全指南：从 OOM、CPU 高到压测配合，测试工程师必知必会"><img src="/img/server-performance-guide.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="🚀 服务器性能问题排查完全指南：从 OOM、CPU 高到压测配合，测试工程师必知必会"/ loading='lazy'></a><div class="content"><a class="title" href="/2026/01/06/2026-01-06-server-performance-troubleshooting-guide/" title="🚀 服务器性能问题排查完全指南：从 OOM、CPU 高到压测配合，测试工程师必知必会">🚀 服务器性能问题排查完全指南：从 OOM、CPU 高到压测配合，测试工程师必知必会</a><time datetime="2026-01-06T12:00:00.000Z" title="发表于 2026-01-06 20:00:00">2026-01-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/05/2026-01-05-llm-agent-future-summary/" title="🌐 主题19｜Agent 工程未来：趋势、机会与系列总结"><img src="/img/llm-agent-future-summary.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="🌐 主题19｜Agent 工程未来：趋势、机会与系列总结"/ loading='lazy'></a><div class="content"><a class="title" href="/2026/01/05/2026-01-05-llm-agent-future-summary/" title="🌐 主题19｜Agent 工程未来：趋势、机会与系列总结">🌐 主题19｜Agent 工程未来：趋势、机会与系列总结</a><time datetime="2026-01-05T10:00:00.000Z" title="发表于 2026-01-05 18:00:00">2026-01-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/04/2026-01-04-llm-agent-ethical-boundaries/" title="⚖️ 主题18｜Agent 伦理边界：偏见、问责制与负责任的 AI"><img src="/img/llm-agent-ethical-boundaries.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="⚖️ 主题18｜Agent 伦理边界：偏见、问责制与负责任的 AI"/ loading='lazy'></a><div class="content"><a class="title" href="/2026/01/04/2026-01-04-llm-agent-ethical-boundaries/" title="⚖️ 主题18｜Agent 伦理边界：偏见、问责制与负责任的 AI">⚖️ 主题18｜Agent 伦理边界：偏见、问责制与负责任的 AI</a><time datetime="2026-01-04T10:00:00.000Z" title="发表于 2026-01-04 18:00:00">2026-01-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/03/2026-01-03-llm-agent-enterprise-applications/" title="🏭 主题17｜Agent 企业应用：RPA、流程自动化与企业落地"><img src="/img/llm-agent-enterprise-applications.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="🏭 主题17｜Agent 企业应用：RPA、流程自动化与企业落地"/ loading='lazy'></a><div class="content"><a class="title" href="/2026/01/03/2026-01-03-llm-agent-enterprise-applications/" title="🏭 主题17｜Agent 企业应用：RPA、流程自动化与企业落地">🏭 主题17｜Agent 企业应用：RPA、流程自动化与企业落地</a><time datetime="2026-01-03T10:00:00.000Z" title="发表于 2026-01-03 18:00:00">2026-01-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2025 - 2026 By yuxiaoling</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null
  const getUtterancesTheme = theme => theme === 'dark' ? 'photon-dark' : 'github-light'

  const loadUtterances = (el = document, key) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyUtterances = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const config = {
      src: 'https://utteranc.es/client.js',
      repo: 'Linn0813/Linn0813.github.io',
      theme: getUtterancesTheme(document.documentElement.getAttribute('data-theme')),
      crossorigin: 'anonymous',
      async: true,
      ...option,
      'issue-term': isShuoshuo ? key : (option && option['issue-term']) || 'pathname'
    }

    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => ele.setAttribute(key, value))
    el.querySelector('#utterances-wrap').appendChild(ele)
  }

  const changeUtterancesTheme = theme => {
    const iframe = document.querySelector('#utterances-wrap iframe')
    if (iframe) {
      const message = {
        type: 'set-theme',
        theme: getUtterancesTheme(theme)
      };
      iframe.contentWindow.postMessage(message, 'https://utteranc.es')
    }
  }

  btf.addGlobalFn('themeChange', changeUtterancesTheme, 'utterances')

  if (isShuoshuo) {
    'Utterances' === 'Utterances'
      ? window.shuoshuoComment = { loadComment: loadUtterances }
      : window.loadOtherComment = loadUtterances
    return
  }
  
  if ('Utterances' === 'Utterances' || !false) {
    if (false) btf.loadComment(document.getElementById('utterances-wrap'), loadUtterances)
    else loadUtterances()
  } else {
    window.loadOtherComment = loadUtterances
  }
})()</script></div><script src="/js/blog-enhancements.js"></script><script src="/js/category-enhancements.js"></script><script src="/js/series-enhancements.js"></script><script src="/js/post-series-meta.js"></script><script src="/js/archive-enhancements.js"></script><script src="/js/tag-enhancements.js"></script><script src="/js/index-enhancements.js"></script><script src="/js/sidebar-series-card.js"></script><script src="/js/theme-switcher-ui.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章、分类、标签..." type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>